<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mùa Hè Xanh UIT 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/Page/style.css">
</head>
<style>
    .create-project-btn {
        background-color: #4CAF50; /* Màu xanh lá */
        color: white; /* Màu chữ */
        border: none; /* Không có viền */
        padding: 10px 20px; /* Khoảng cách bên trong */
        text-align: center; /* Căn giữa chữ */
        text-decoration: none; /* Không có gạch chân */
        display: inline-block; /* Hiển thị như một khối inline */
        font-size: 16px; /* Kích thước chữ */
        margin: 4px 2px; /* Khoảng cách bên ngoài */
        cursor: pointer; /* Con trỏ chuột thay đổi khi hover */
        border-radius: 25px; /* Bo tròn góc nhiều hơn */
        transition: background-color 0.3s ease; /* Hiệu ứng chuyển màu */
    }
    
    .create-project-btn:hover {
        background-color: #45a049; /* Màu xanh đậm hơn khi hover */
    }
    
    .dialog {
                display: none; /* Ẩn dialog ban đầu */
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: white;
                border-radius: 16px;
                box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                padding: 20px;
                width: 90%;
                max-width: 600px;
            }
            .overlay {
                display: none; /* Ẩn overlay ban đầu */
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 900;
            }
            h2 {
                text-align: center;
                margin-bottom: 0px;
                font-weight: bold;
            }
            .btn-cancel, .btn-submit {
                width: 48%;
                transition: background-color 0.3s ease-in-out;
            }
            .btn-cancel {
                background-color: #ff4d4d;
                border: none;
                color: white;
            }
            .btn-submit {
                background-color: #28a745;
                border: none;
                color: white;
            }
            .btn-cancel:hover {
                background-color: #ff1a1a;
            }
            .btn-submit:hover {
                background-color: #218838;
            }
            .error-message {
                color: red;
                font-size: 0.9em;
                display: none;
                margin-top: 5px;
            }
    
    </style>
    <!-- CSS tùy chọn để hiển thị dialog modal -->
    <style>
        .modal {
          position: fixed;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          display: flex;
          justify-content: center;
          align-items: center;
        }
        .modal-content {
          background: white;
          padding: 20px;
          border-radius: 8px;
          width: 400px;
          text-align: center;
        }
        .close-button {
          cursor: pointer;
          color: red;
          font-size: 20px;
          position: absolute;
          top: 10px;
          right: 10px;
        }
      </style>
      <style>
      /* Styles cho modal */
      .modal {
          display: none; /* Ẩn modal theo mặc định */
          position: fixed; /* Đặt vị trí cố định */
          z-index: 1000; /* Đặt z-index cao để đảm bảo modal nằm trên các phần khác */
          left: 0;
          top: 0;
          width: 100%; /* Chiếm toàn bộ chiều rộng */
          height: 100%; /* Chiếm toàn bộ chiều cao */
          overflow: auto; /* Thêm cuộn nếu cần */
          background-color: rgba(0, 0, 0, 0.5); /* Nền mờ */
      }
      
      /* Styles cho nội dung modal */
      .modal-content {
          background-color: #fefefe; /* Nền trắng cho nội dung modal */
          margin: 15% auto; /* Căn giữa theo chiều dọc */
          padding: 20px; /* Thêm khoảng cách bên trong */
          border: 1px solid #888; /* Đường viền */
          width: 100%; /* Chiều rộng của modal */
          max-width: 800px; /* Chiều rộng tối đa của modal */
          border-radius: 8px; /* Bo tròn góc */
      }
      
      /* Styles cho nút đóng */
      .close-button {
          color: #aaa; /* Màu xám cho nút đóng */
          float: right; /* Đưa nút đóng sang bên phải */
          font-size: 28px; /* Kích thước chữ cho nút đóng */
          font-weight: bold; /* Chữ đậm cho nút đóng */
      }
      
      /* Styles cho nút đóng khi hover */
      .close-button:hover,
      .close-button:focus {
          color: black; /* Đổi màu khi hover */
          text-decoration: none; /* Bỏ gạch chân */
          cursor: pointer; /* Hiển thị con trỏ khi hover */
      }
      
      /* Styles cho tiêu đề */
      h3 {
          margin: 0; /* Bỏ margin cho tiêu đề */
      }
      
      /* Styles cho thông tin trong modal */
      p {
          font-size: 16px; /* Kích thước chữ cho thông tin */
          margin: 8px 0; /* Khoảng cách giữa các đoạn */
      }
    </style>
<body>
    <header id="header-placeholder"></header>

        <section class="campaigns">
            <div class="campaigns-header">
                <div class="campaigns-title">
                    <span class="category-label">Mùa Hè Xanh UIT</span>
                    <h2>Các Chiến Dịch</h2>
                </div>
            </div>
            <div id="campaignGrid" class="campaign-grid"></div>

            <!-- Dialog modal sẽ được tạo động cho từng chiến dịch -->
            <div id="modalContainer"></div>
        </section>
        <footer id="footer-placeholder"></footer>
    </main>
    <!-- Modal -->
<div id="registerDialog" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div class="container">
            <div class="hero-content">
                <header>
                    <img src="/Public/assets/logo.png" alt="Mùa Hè Xanh 2025 Logo" class="logo">
                    <h2>ĐĂNG KÝ CHIẾN DỊCH</h2>
                </header>
                
                <form action="#" method="post">
                    <input type="text" id="campaignId" hidden required>
                    <div class="form-group">
                        <label for="name">Họ Tên</label>
                        <input type="text" id="name" name="name" required>
                    </div>

                    <div class="form-group">
                        <label for="mssv">Mã số Sinh viên</label>
                        <input type="text" id="mssv" name="mssv" required>
                    </div>

                    <div class="form-group">
                        <label for="sdt">Số điện thoại</label>
                        <input type="tel" id="sdt" name="sdt" required>
                    </div>

                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required>
                    </div>

                    <div class="form-group">
                        <label for="address">Địa chỉ</label>
                        <input type="text" id="address" name="address" required>
                    </div>

                    <div class="form-group">
                        <label for="sdtParent">Số điện thoại gia đình</label>
                        <input type="tel" id="sdtParent" name="sdtParent" required>
                    </div>

                    <div class="form-group">
                        <label for="reason">Lý do muốn đăng ký</label>
                        <input type="text" id="reason" name="reason" required>
                    </div>

                    <div class="form-group">
                        <label for="aim">Mục tiêu muốn đạt được</label>
                        <textarea id="aim" name="aim" rows="3" required></textarea>
                    </div>

                    <button type="submit" class="register-button">Đăng ký</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Lấy form và gắn sự kiện submit
document.getElementById("registerForm").addEventListener("submit", function(event) {
    event.preventDefault(); // Ngăn form tự động submit để có thể xử lý thủ công

    // Kiểm tra sự kiện đã được kích hoạt
    alert("Form submit event triggered!");

    // Lấy giá trị từ các trường nhập liệu
    const name = document.getElementById("hoTen").value;
    const sdt = document.getElementById("sdt").value;
    const email = document.getElementById("email").value;
    const address = document.getElementById("diaChi").value;
    const sdtParent = document.getElementById("sdtNguoiThan").value;
    const reason = document.getElementById("liDo").value;
    const aim = document.getElementById("nguyenVong").value;
    const mssv = document.getElementById("mssv").value;
    const campaignId = document.getElementById("campaignId").value;

    // Tạo body của request
    const requestBody = {
        name: name,
        sdt: sdt,
        email: email,
        address: address,
        sdtParent: sdtParent,
        reason: reason,
        aim: aim,
        mssv: mssv,
        campaignId: campaignId
    };

    // Gửi request POST đến API
    fetch('https://localhost:7009/api/Register/RegisterCampaign', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(requestBody), // Chuyển đổi object thành JSON
    })
    .then(response => response.json()) // Chuyển đổi phản hồi thành JSON
    .then(data => {
        // Xử lý phản hồi từ API
        if (data.success) {
            alert("Thành công: " + data.data); // Hiển thị thông báo thành công
        } else {
            alert("Lỗi: Đăng ký không thành công!"); // Hiển thị thông báo lỗi
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert("Lỗi: Không thể kết nối đến API!"); // Hiển thị thông báo lỗi nếu có sự cố
    });
});

</script>
<script>
    fetch('/Page/Component/Header.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('header-placeholder').innerHTML = data;
            attachLogoutEvent(); // Gán sự kiện cho nút sau khi header được tải
        });
    
    function attachLogoutEvent() {
        document.getElementById("log-out").addEventListener("click", function() {
            window.location.replace("login.html"); // Thay đổi "login.html" thành đường dẫn thực tế đến trang đăng nhập của bạn
        });
    }
    </script>
    <script>
        fetch('/Page/Component/Footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-placeholder').innerHTML = data;
            });
    </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+FniFNJ+zIFpbhrvY4hZfME6fI6q" crossorigin="anonymous"></script>
     <script>
        // Hàm lấy dữ liệu từ API và hiển thị các campaign card
        async function loadCampaigns() {
    try {
        const response = await fetch('https://localhost:7009/api/Campaign/CampaignOnGoing');  // Gọi API
        const campaigns = await response.json();  // Chuyển dữ liệu JSON thành mảng object
        const campaignGrid = document.getElementById("campaignGrid");
        const modalContainer = document.getElementById("modalContainer");

        campaignGrid.innerHTML = "";  // Xóa nội dung cũ nếu có
        modalContainer.innerHTML = "";  // Xóa nội dung modal cũ nếu có

        // Duyệt qua từng chiến dịch và tạo card
        campaigns.forEach(campaign => {
            const card = document.createElement("div");
            card.className = "campaign-card";
            card.innerHTML = `
                <img src="/Public/Logo/campaign.png" alt="${campaign.name}">
                <div class="campaign-info">
                    <h3>${campaign.name}</h3>
                    <div class="date-container">
                        <span class="calendar-icon">📅</span>
                        <span class="campaign-date">${campaign.time}</span>
                    </div>
                    <a href="#" class="register-button" onclick="openModal('${campaign.id}')">Xem Chi Tiết</a>
                </div>
            `;
            campaignGrid.appendChild(card);

            // Tạo modal cho từng chiến dịch
            const modal = document.createElement("div");
            modal.id = `campaignDetailModal-${campaign.id}`;
            modal.style.display = "none";
            modal.className = "modal";
            modal.innerHTML = `
                <div class="modal-content">
    <div class="modal-header">
        <h5 class="modal-title" id="campaignName-${campaign.id}">${campaign.name}</h5>
        <button type="button" class="close" onclick="closeModal('${campaign.id}')" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <p id="campaignUniversity-${campaign.id}"></p>
        <p id="campaignDescription-${campaign.id}"></p>
        <p id="campaignQuantity-${campaign.id}"></p>
        <p id="campaignTime-${campaign.id}"></p>
        <p id="campaignCreatedAt-${campaign.id}"></p>
        <p id="campaignStatus-${campaign.id}"></p>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" onclick="approveCampaign('${campaign.id}')">Đăng ký</button>
        <button type="button" class="btn btn-secondary" onclick="closeModal('${campaign.id}')">Đóng</button>
    </div>
</div>

            `;
            modalContainer.appendChild(modal);
        });
    } catch (error) {
        console.error("Có lỗi xảy ra khi lấy dữ liệu từ API:", error);
    }
}



// Hàm mở modal và hiển thị chi tiết chiến dịch
function openModal(campaignId) {
    fetch('https://localhost:7009/api/Campaign')
        .then(response => response.json())
        .then(campaigns => {
            const campaign = campaigns.find(c => c.id === campaignId);
            if (campaign) {
                document.getElementById(`campaignName-${campaignId}`).innerText = `Tên đội hình: ${campaign.name}`;
                document.getElementById(`campaignUniversity-${campaignId}`).innerText = `Trường Đại học: ${campaign.university}`;
                document.getElementById(`campaignDescription-${campaignId}`).innerText = `Mô tả: ${campaign.description}`;
                document.getElementById(`campaignQuantity-${campaignId}`).innerText = `Số lượng chiến sĩ: ${campaign.quantity}`;
                document.getElementById(`campaignTime-${campaignId}`).innerText = `Thời gian: ${campaign.time}`;  // Hiển thị time dạng string
                document.getElementById(`campaignCreatedAt-${campaignId}`).innerText = `Chiến dịch được tạo lúc: ${new Date(campaign.createdAt).toLocaleString()}`;
                document.getElementById(`campaignStatus-${campaignId}`).innerText = `Trạng thái: ${campaign.status}`;
                
                document.getElementById('campaignId').value = campaignId;
                
                document.getElementById(`campaignDetailModal-${campaignId}`).style.display = "block";
            }
        })
        .catch(error => console.error('Error fetching campaign details:', error));
}

// Hàm đóng modal
function closeModal(campaignId) {
    document.getElementById(`campaignDetailModal-${campaignId}`).style.display = "none";
}

// Gọi hàm loadCampaigns khi trang được tải
window.onload = loadCampaigns;

document.querySelector(".register-button").addEventListener("click", function (event) {
    event.preventDefault();

    // Lấy dữ liệu từ form
    const name = document.getElementById("name").value;
    const sdt = document.getElementById("sdt").value;
    const email = document.getElementById("email").value;
    const address = document.getElementById("address").value;
    const sdtParent = document.getElementById("sdtParent").value;
    const reason = document.getElementById("reason").value;
    const aim = document.getElementById("aim").value;
    const mssv = document.getElementById("mssv").value;
    const campaignId = document.getElementById("campaignId").value;

    // Kiểm tra các giá trị có rỗng hay không
    if (!name || !sdt || !email || !address || !sdtParent || !reason || !aim || !mssv || !campaignId) {
        alert("Vui lòng điền đầy đủ thông tin");
        return;
    }

    // Tạo body cho yêu cầu POST
    const data = {
        name: name,
        sdt: sdt,
        email: email,
        address: address,
        sdtParent: sdtParent,
        reason: reason,
        aim: aim,
        mssv: mssv,
        campaignId: campaignId
    };

    // Gửi yêu cầu POST
    fetch("https://localhost:7009/api/Register/RegisterCampaign", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
    })
    .then(response => response.json())
    .then(result => {
        // Kiểm tra phản hồi từ API
        if (result.success) {
            alert("Thành công: " + result.data);
            // Gọi hàm này khi bạn muốn đóng tất cả các hộp thoại
            closeAllModals();           
        } else {
            alert("Lỗi: "+result.data);
        }
    })
    .catch(error => {
        console.error("Error:", error);
        alert("Đã xảy ra lỗi khi gửi yêu cầu");
    });
});
function closeAllModals() {
    // Lấy tất cả các phần tử có lớp "modal"
    var modals = document.querySelectorAll('.modal');
    
    // Lặp qua các phần tử và đặt display thành "none" để đóng
    modals.forEach(function(modal) {
        modal.style.display = "none";
    });
}


</script>
<script>
    // Lấy modal
    var modal = document.getElementById("registerDialog");

    function approveCampaign(campaignId) {
    document.getElementById(`campaignDetailModal-${campaignId}`).style.display = "none";
    modal.style.display = "block";            
}

    // Lấy phần tử <span> để đóng modal
    var span = document.getElementsByClassName("close")[0];

    // Khi người dùng click vào <span> (x), đóng modal
    span.onclick = function() {
        modal.style.display = "none";
    }

    // Khi người dùng click bên ngoài modal, đóng modal
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
    //
</script>
</body>
</html>